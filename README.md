# BlazeDemo Load Testing - Live Workshop Demo

Live demo for the **Test Automation and Performance Testing Workshop** with k6.

This project demonstrates how to implement a **realistic E2E test** for a web application, featuring:
- âœ… Complete workflow automation (flight booking)
- âœ… Load testing, stress testing, spike testing, and soak testing scenarios
- âœ… Dynamic data correlation from responses
- âœ… Robust error handling and validation
- âœ… Environment-based configuration
- âœ… Custom JSON reporting with summaryHelper

---

## ğŸ“‹ Project Structure

```
live-demo/
â”œâ”€â”€ Config/
â”‚   â””â”€â”€ env.js                # Configuration (baseUrl, stages for Load/Stress/Spike/Soak, thresholds)
â”‚
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ users.json            # Test users with payment data
â”‚   â””â”€â”€ routes.json           # Flight routes to test
â”‚
â”œâ”€â”€ Helpers/
â”‚   â”œâ”€â”€ summaryHelper.js      # Helper to generate custom JSON reports
â”‚   â””â”€â”€ utils.js              # Utility functions (data picking, form body formatting)
â”‚
â”œâ”€â”€ Scripts/
â”‚   â”œâ”€â”€ blaze-custom.js       # Main test script (optimized & robust)
â”‚   â””â”€â”€ blaze.js              # Script generated by k6 Studio (reference)
â”‚
â”œâ”€â”€ Output/
â”‚   â””â”€â”€ Summary/              # Where reports are saved (ignored by git)
â”‚
â””â”€â”€ README.md                 # This file
```

---

## ğŸ¯ How It Works

The `blaze-custom.js` script simulates a **complete user journey**:

1. **GET /** â†’ Visit home page
2. **POST /reserve.php** â†’ Select a flight route
3. **Dynamic Extraction** â†’ Extract `flight`, `price`, and `airline` from the hidden inputs in the HTML response.
   - *Robustness Check*: If extraction fails, the iteration stops early to prevent invalid requests.
4. **POST /purchase.php** â†’ Complete purchase with the **correct flight details** extracted in step 3.
5. **POST /confirmation.php** â†’ Confirm booking
6. **Sleep** â†’ Configurable pause between iterations

### Load Configuration

The `Config/env.js` file now includes configurations for various test types. Uncomment the desired section to run:

- **Load Test** (Default): Simulates normal traffic.
- **Stress Test**: Pushes the system to its breaking point.
- **Spike Test**: Simulates sudden traffic surges.
- **Soak Test**: Validates reliability over a long period.

Example `env.js` snippet:
```json
"stages": [
  // --- LOAD TEST (Default) ---
  { "target": 10, "duration": "1m" },
  { "target": 10, "duration": "3m" },
  { "target": 0, "duration": "1m" }
]
```

---

## ğŸš€ Quick Start

### Requirements

- **k6** (v0.40+)
- **Node.js** (optional, only if using other scripts)
- **Windows/Mac/Linux**

### Installation

#### Windows (PowerShell)

```powershell
# Install k6 via Chocolatey
choco install k6

# Verify installation
k6 version
```

#### macOS

```bash
brew install k6
k6 version
```

#### Linux (Ubuntu/Debian)

```bash
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6
```

### Running Tests

#### Basic run (1 VU, 1 iteration)

```powershell
cd .\Scripts\
k6 run blaze-custom.js
```

#### Full load test (using config from env.js)

```powershell
cd .\Scripts\
k6 run blaze-custom.js --summary-trend-stats="med,p(95),p(99)"
```

#### With environment override

```powershell
k6 run blaze-custom.js `
  --env BASE_URL=https://blazedemo.com `
  --env SLEEP_S=2 `
  --env P95_MS=1000
```

#### With verbose output

```powershell
k6 run blaze-custom.js -v --summary-trend-stats="med,p(95),p(99)"
```

---

## ğŸ“Š Output and Reporting

### Standard Report (Console)

k6 automatically shows:
- HTTP metrics (duration, errors, rates)
- Group metrics (blazedemo_e2e_http)
- Checks passed/failed
- Threshold violations

### Custom Report (JSON)

The `Helpers/summaryHelper.js` file automatically generates:

```
Output/Summary/summary_DDMMYY_HH_SS.json
```

Contains: `http_reqs`, `http_req_duration`, `http_req_failed`, etc. in formatted JSON.

---

## ğŸ”§ Configurable Parameters

You can control the test via environment variables:

| Variable | Default | Description |
|-----------|---------|-------------|
| `BASE_URL` | https://blazedemo.com | App URL |
| `SLEEP_S` | 1 (from env.js) | Sleep between iterations (seconds) |
| `P95_MS` | null | P95 threshold (e.g., 800 ms). If set, fails if p(95) > value |

### Example: Performance Test with Threshold

```powershell
k6 run blaze-custom.js --env P95_MS=800
# Fails if p(95) of request duration > 800ms
```

---

## ğŸ“ˆ Key Metrics

- **http_req_duration** â†’ HTTP response time
- **http_req_failed** â†’ % failed requests (target: <1%)
- **checks** â†’ Custom validations (GET / status 200, flight id extracted, etc.)
- **data_received/sent** â†’ Bandwidth used

---

## ğŸ’¡ Tips & Tricks

### Debugging a failed test

```powershell
# Run with a single VU to see the full stack trace
k6 run blaze-custom.js -u 1 -i 1 -v
```

### Test only a specific request

Comment out other requests in `blaze-custom.js` during debugging.

### Check response body

```javascript
console.log(res.body);  // Prints response to k6 console
```

---

## ğŸ“ Extra Info

- **Test App**: https://blazedemo.com (public demo)
- **k6 Docs**: https://k6.io/docs/
- **Community**: https://community.k6.io/

---

**Happy testing! ğŸš€**
